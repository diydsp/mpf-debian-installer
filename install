#!/bin/bash

echo
echo "[INFO] Installing prerequsites via apt-get"

sudo apt-get update
sudo add-apt-repository -y ppa:kivy-team/kivy
sudo apt-get update

sudo apt-get install -y python3-kivy

sudo apt-get install -y git cython3 libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev libav-tools libportmidi-dev libswscale-dev libavformat-dev libavcodec-dev zlib1g-dev python3-pip
sudo apt-get -y install gstreamer1.0

echo
echo "[INFO] Installing MPF"

sudo cp 50-P-ROC.rules /etc/udev/rules.d
sudo cp 51-P3-ROC.rules /etc/udev/rules.d

sudo pip3 install --pre mpf-mc

echo
echo "[INFO] Downloading example game files"

mkdir ~/pinball
cd ~/pinball
git clone --branch dev https://github.com/missionpinball/mpf-examples

echo "                   Installation finished."
echo "============================================================"
echo "   If you're using a P-ROC or P3-ROC, you should reboot."
echo ""
echo "      When you are done, check your home folder for a"
echo "      'pinball' folder. In there is the folders you"
echo "                    need to get started."
echo ""
echo "   For more information, visit docs.missionpinball.com"
echo ""
echo "                     Happy pinballing!"
echo ""
read -p "Do you want to reboot now? (y or n)" -n 1 -r REBOOTREPLY
echo    # (optional) move to a new line
if [[ $REBOOTREPLY = "y" ]]; then
  read -p "Are you sure you want to reboot? (y or n)" -n 1 -r REBOOTREPLYCONFIRM
  echo    # (optional) move to a new line
  if [[ $REBOOTREPLYCONFIRM = "y" ]]; then
    sudo shutdown -r now
  else
    echo "REMEMBER TO REBOOT BEFORE YOU TRY TO USE THE GAME"
  fi
else
  echo "REMEMBER TO REBOOT BEFORE YOU TRY TO USE THE GAME"
fi
